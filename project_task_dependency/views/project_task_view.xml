<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_task_form2" model="ir.ui.view">
        <field name="name">project.task.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='description_page']" position="after">
                <page string="Dependencies">
                    <field name="recursive_dependency_task_ids" invisible="1"/>
                    <field name="dependency_task_ids"
                           domain="[('id', '!=', id), ('id', 'not in', recursive_dependency_task_ids)]">
                        <tree>
                            <field name="name"/>
                            <field name="user_id"/>
                            <field name="date_deadline"/>
                            <field name="stage_id"/>
                            <field name="closed" string="Closed"/>

                            <button name="button_open_task"
                                    type="object" title="Open Task"
                                    icon="fa-window-restore"
                                    aria-label="Open Task"
                                    class="btn-link"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_task_kanban" model="ir.ui.view">
        <field name="name">project.task.kanban</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="arch" type="xml">
            <field name="color" position="after">
                <field name="dependency_open_task_count"/>
            </field>

            <xpath expr="//div[hasclass('oe_kanban_bottom_left')]" position="inside">
                <div class="pull-right" groups="base.group_user" style="margin-left: 10px;">
                    <t attrs="{'invisible': [('dependency_open_task_count', '=', 0)]}">
                        <a type="object" name="button_action_dependency_tasks" style="font-weight:bold;color:orange">
                            <span class="fa fa-exclamation-triangle fa-lg"/>
                            <span><field name="dependency_open_task_count"/></span>
                        </a>
                    </t>
                </div>
            </xpath>
        </field>
    </record>

    <record id="action_dependency_tasks" model="ir.actions.act_window">
        <field name="name">Dependency Tasks</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph,activity</field>
        <field name="search_view_id" ref="project.view_task_search_form"/>
    </record>
</odoo>
